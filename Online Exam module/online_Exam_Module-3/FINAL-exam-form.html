<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Online Exam Module</title>
	<link rel="stylesheet" href="style1.css">
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"> -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/fontawesome.min.css">
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"> -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
	<style>
	</style>
</head>

<!-- <body onload="loadCamera()"> -->
	<body onload="loadCamera()" class="body-class">
		
	<!-- <header class="header bg-primary">
		<div class="left-title">JS Quiz</div>
		<div class="right-title">Total Questions: <span id="tque"></span></div>
		<div class="clearfix"></div>
	</header> -->
	<header class="header bg-primary">
		<div class="left-title">Online Exam Module</div>
		<!-- <div class="right-title">Total Questions: <span id="tque"></span></div> -->
		<!-- <div class="clearfix"></div> -->
	</header>
	<div class="content">
		<div class="container-fluid">
            <div class="row language-timer">
                <div class="col-sm-3"></div>
                <div class="col-sm-3"></div>
                <div class="col-sm-3"></div>
                <div class="col-sm-3">  </div>
            </div>
				
			<div class="myrow row">
				<div class="col-sm-9" >
					<div id="result" class="quiz-body">
						<form name="quizForm " onSubmit="">
							<div class="form-group">
								<div><span id="qid">1.</span> <span id="question"></span></div>
								<div class="option-block-container" id="question-options">
								</div> <!-- End of option block -->
							</div>
						</form>

						<!-- <div class="row button-container">
							<div class="col-sm-6">
								<button name="previous" id="previous" class="btn btn-success">Previous</button>
							</div>
							<div class="col-sm-6 ">
								<button name="next" id="next" class="btn btn-success">Next</button>
							</div>
						</div> -->
						
						
					</div>
					<div class=" button-container">
						<div class="div-btn-style">
							<button name="previous" id="previous" class="btn btn-success ">Previous</button>
						</div>
						<div class="div-btn-style">
							<button name="next" id="next" class="btn btn-success ">Next</button>
						</div>
						<div class="div-btn-style">
							<button  class="btn btn-primary">Review Later</button>
						</div>
						<div class="div-btn-style">
							<button class="btn btn-warning">Clear Response</button>
						</div>
					</div>		
				</div> 
		        <div class="col-sm-3 right-section" >
                        
					<div class="row camera-timer-section">
						<div class="col-sm-6 timer-section">
							<p>Time Left</p>
							<p >02:56:44</p>
						</div>
						<div class="col-sm-6">
							<div>
								<video id="vid"></video>
							</div>
						</div>
					</div>
					<div class="row student-info-section">


						<div class="table-responsive-sm ">
							<table class="table ">
							         
								<tbody  >
									<tr class="">
										<td >Student Name</td>
										<!-- <td class="tdWidth"> : </td> -->
										<td>Ram Shyam</td>  
									</tr>
									<tr>
										<td class="">Student Name</td>
										<!-- <td class="tdWidth"> : </td> -->
										<td>Ram Shyam</td>  
									</tr>
									<tr>
										<td class="">Student Name</td>
								 
										<td>Ram Shyam</td>  
									</tr>
									<tr>
										<td class="">Student Name</td>
									   
										<td>Ram Shyam</td>  
									</tr>
									
								</tbody>
							</table>
						</div>


					</div>
					<div class="row question-number-section">
						<div class="col-sm-12">
							
								<div class="flex-container">
									<div class="question-number">1</div>
									<div class="question-number">2</div>
									<div class="question-number">3</div> 
									<div class="question-number">1</div>
									<div class="question-number">2</div>
									<div class="question-number">3</div>
									
									<div class="question-number">2</div>
									<div class="question-number">3</div> 
									<div class="question-number">1</div>
									<div class="question-number">2</div>
									<div class="question-number">3</div>
									<div class="question-number">1</div>
									<div class="question-number">1</div>
									<div class="question-number">2</div>
									<div class="question-number">3</div> 
									<div class="question-number">1</div>
									<div class="question-number">2</div>
									<div class="question-number">3</div>
									<div class="question-number">1</div>
									<br>
									<div class="question-numbers-buttons ">
										<button type="button" class="btn-xs">Not Visited</button>
										<button type="button" class="btn-xs">Not Answered</button>
										<button type="button" class="btn-xs">Answered</button>
										<button type="button" class="btn-xs">Review</button>
										<button type="button" class="btn-xs">Review Answered</button>
									</div>
									
								  </div>
							
						</div>
					</div>                                     
                </div>
			</div> 

			
			
			<!-- End of row -->
		</div> <!-- ENd of container fluid -->
	</div> <!-- End of content -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://superal.github.io/canvas2image/canvas2image.js"></script>

	<script src="app.js"></script>

    <script>
	  function loadCamera() {
        let media_rec = null;
        let blobs_rec = [];
        let video_local;
        let video = document.getElementById("vid");
        let mediaDevices = navigator.mediaDevices;
        vid.muted = true;
        // Accessing the user camera and video.
        mediaDevices.getUserMedia({ video: true, audio: true, })
            .then((stream) => {
                // Changing the source of video to current stream.
                video.srcObject = stream;
                video.addEventListener("loadedmetadata", () => {
                    video.play();
                });

                // set MIME type of recording as video/webm
                media_rec = new MediaRecorder(stream, { mimeType: 'video/webm' });
                 
                // event : new recorded video blob available 
                media_rec.addEventListener('dataavailable', function (e) {
                    console.log("###### e.data.size:::" + e.data.size);
                    if( e.data.size){
                        blobs_rec.push(e.data);
                        console.log("##### e.data is:::" + e.data);
                    }
                });

                 // demo: to download after given time
				 setInterval((event) => {
                    console.log("stopping");
                    media_rec.stop();
                  	download(blobs_rec);
					  takeScreenshot();
                    }, 20000);   

					
                    media_rec.start(1000);
               
                })
            .catch(alert);

			// setInterval(takeScreenshot, 20000);  
    };

    function download(blobs_rec) {
        const blob = new Blob(blobs_rec, {
            type: "video/webm",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        document.body.appendChild(a);
        a.style = "display: none";
        a.href = url;
        a.download = "test.webm";
        a.click();
        window.URL.revokeObjectURL(url);
    }

	function takeScreenshot(){
         const screenshotTarget = document.body;
            html2canvas(screenshotTarget).then(canvas => {
                // to image as png use below line
                // const base64image = canvas.toDataURL("image/png");
                // show the image in window use below line
                // window.location.href = base64image;
                
                // screenshot appended to the body as canvas
               // document.body.appendChild(canvas);  
                dataURL = canvas.toDataURL();  
                Canvas2Image.saveAsPNG(canvas);
                // to print the screenshot in console use below line
                // console.log(dataURL);
                
                // following line is optional and it is to save the screenshot
                // on the server side. It initiates an ajax call
                pushScreenshotToServer(dataURL); 
            });  
}

function pushScreenshotToServer(dataURL) {  
            $.ajax({ 
                url: "push-screenshot.php",  
                type: "POST",  
                data: {  
                    image: dataURL  
                },  
                dataType: "html", 
                success: function() {  
                	console.log('Screenshot pushed to server.');
                }  
            });  
        } 
	</script>

</body>

<script type="text/javascript">

	/* Created and coded by Vishwanath Pater */
	/* Quiz source: w3schools.com */
	var quiz = {
		"JS": [
			{
				"id": 1,
				"question": "Inside which HTML element do we put the JavaScript?",
				"options": [
					{
						"a": "&lt;script&gt;",
						"b": "&lt;javascript&gt;",
						"c": "&lt;scripting&gt;",
						"d": "&lt;js&gt;"
					}
				],
				"answer": "&lt;script&gt;",
				"score": 0,
				"status": ""
			},
			{
				"id": 2,
				"question": "How do you write &quot;Hello Woeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeerld&quot; in an alert box? How do you write &quot;Hello Woeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeerld&quot; in an alert box?How do you write &quot;Hello Woeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeerld&quot; in an alert box?",
				"options": [
					{
						"a": "The &lt;head&gt; section",
						"b": "The &lt;body&gt; section",
						"c": "Both the &lt;head&gt; section and the &lt;body&gt; section are correct"
					}
				],
				"answer": "Both the &lt;head&gt; section and the &lt;body&gt; section are correct",
				"score": 0,
				"status": ""
			},
			{
				"id": 3,
				"question": "What is the correct syntax for referring to an external script called 'xxx.js'?",
				"options": [
					{
						"a": "&ltscript href=&quot;xxx.js&quot;>",
						"b": "&lt;script name=&quot;xxx.js&quot;&gt;",
						"c": "&lt;script src=&quot;xxx.js&quot;&gt;"
					}
				],
				"answer": "&lt;script src=&quot;xxx.js&quot;&gt;",
				"score": 0,
				"status": ""
			},
			
		]
	}
	var quizApp = function () {
		this.score = 0;
		this.qno = 1;
		this.currentque = 0;
		var totalque = quiz.JS.length;
		this.displayQuiz = function (cque) {
			this.currentque = cque;
			if (this.currentque < totalque) {
				let qestionId = quiz.JS[this.currentque].id;
				console.log("####displayQuiz---questionId::"+qestionId);
				if (qestionId == totalque) {
    				$("#next").html("Submit");
				}
				if (qestionId < totalque) {
    				$("#next").html("next");
				}
				$("#tque").html(totalque);
				$("#previous").attr("disabled", false);
				$("#next").attr("disabled", false);
				$("#qid").html(quiz.JS[this.currentque].id + '.');
				$("#question").html(quiz.JS[this.currentque].question);
				$("#question-options").html("");

                for (var key in quiz.JS[this.currentque].options[0]) {
					if (quiz.JS[this.currentque].options[0].hasOwnProperty(key)) {
						$("#question-options").append(
							"<div >" +
							"<label >" +
							"<input type='radio' class='questions' name='option' id='q" + key + "' value='" + quiz.JS[this.currentque].options[0][key] + "'><span id='optionval'>" +
							quiz.JS[this.currentque].options[0][key] +
							"</span></label>"
						);
					}
				}

				//loadCamera();

			}
			if (this.currentque <= 0) {
				$("#previous").attr("disabled", true);
			}
			if (this.currentque >= totalque) {
				$('#next').attr('disabled', true);
				for (var i = 0; i < totalque; i++) {
					this.score = this.score + quiz.JS[i].score;
				}
				return this.showResult(this.score);
			}
		}
		this.showResult = function (scr) {
			$("#result").addClass('result');
			$(".right-section").css("display", "none ");
			$("#next").css("display", "none ");
			$("#previous").css("display", "none ");
			$("#result").html("<h1 class='res-header'>Total Score: &nbsp;" + scr + '/' + totalque + "</h1>");
			for (var j = 0; j < totalque; j++) {
				var res;
				if (quiz.JS[j].score == 0) {
					res = '<span class="wrong">' + quiz.JS[j].score + '</span><i class="fa fa-remove c-wrong"></i>';
				} else {
					res = '<span class="correct">' + quiz.JS[j].score + '</span><i class="fa fa-check c-correct"></i>';
				}
				$("#result").append(
					'<div class="result-question"><span>Q ' + quiz.JS[j].id + '</span> &nbsp;' + quiz.JS[j].question + '</div>' +
					'<div><b>Correct answer:</b> &nbsp;' + quiz.JS[j].answer + '</div>' +
					'<div class="last-row"><b>Score:</b> &nbsp;' + res +
					'</div>'
				);
			}
		}
		
		this.checkAnswer = function (option) {
			var answer = quiz.JS[this.currentque].answer;
			option = option.replace(/</g, "&lt;") //for <
			option = option.replace(/>/g, "&gt;") //for >
			option = option.replace(/"/g, "&quot;")
			if (option == quiz.JS[this.currentque].answer) {
				if (quiz.JS[this.currentque].score == "") {
					quiz.JS[this.currentque].score = 1;
					quiz.JS[this.currentque].status = "correct";
				}
			} else {
				quiz.JS[this.currentque].status = "wrong";
			}
		}
		
		this.changeQuestion = function (cque) {
			this.currentque = this.currentque + cque;
		
				this.displayQuiz(this.currentque);
		}
	}
	var jsq = new quizApp();
	var selectedopt;
	$(document).ready(function () {
		jsq.displayQuiz(0);
		$('#question-options').on('change', 'input[type=radio][name=option]', function (e) {
			//var radio = $(this).find('input:radio');
			$(this).prop("checked", true);
			selectedopt = $(this).val();
		});
	});
	$('#next').click(function (e) {
		e.preventDefault();
		if (selectedopt) {
			jsq.checkAnswer(selectedopt);
		}
		jsq.changeQuestion(1);
	});
	$('#previous').click(function (e) {
		e.preventDefault();
		if (selectedopt) {
			jsq.checkAnswer(selectedopt);
		}
		jsq.changeQuestion(-1);
	});
</script>
</html>